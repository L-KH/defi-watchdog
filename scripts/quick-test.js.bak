// scripts/quick-test.js
const hre = require("hardhat");

async function main() {
  console.log("ğŸ” Quick DeFi Watchdog Contract Test...");
  
  const contractAddress = process.env.NEXT_PUBLIC_AUDIT_NFT_CONTRACT || 
                         '0x46E086aac77023AD6E1EA65cC23A6f0Fa91Cf118';
  
  console.log("ğŸ“ Contract Address:", contractAddress);
  console.log("ğŸŒ Network:", hre.network.name);
  
  try {
    // Check if contract exists
    const code = await hre.ethers.provider.getCode(contractAddress);
    if (code === '0x') {
      throw new Error('No contract found at this address');
    }
    
    console.log("âœ… Contract exists at address");
    console.log("ğŸ“‹ Contract Code Size:", code.length - 2, "bytes");
    
    // Get contract instance
    const DeFiWatchdogAuditNFT = await hre.ethers.getContractFactory("DeFiWatchdogAuditNFT");
    const contract = DeFiWatchdogAuditNFT.attach(contractAddress);
    
    // Test basic function calls
    console.log("\nğŸ“Š Testing Basic Functions:");
    
    const name = await contract.name();
    console.log("âœ… Contract Name:", name);
    
    const symbol = await contract.symbol();
    console.log("âœ… Contract Symbol:", symbol);
    
    const staticPrice = await contract.STATIC_AUDIT_PRICE();
    console.log("âœ… Static Price:", hre.ethers.utils.formatEther(staticPrice), "ETH");
    
    const aiPrice = await contract.AI_AUDIT_PRICE();
    console.log("âœ… AI Price:", hre.ethers.utils.formatEther(aiPrice), "ETH");
    
    const totalAudits = await contract.getTotalAudits();
    console.log("âœ… Total Audits:", totalAudits.toString());
    
    console.log("\nğŸ‰ Quick test completed successfully!");
    console.log("ğŸ¯ Contract is responsive and working correctly");
    
  } catch (error) {
    console.error("âŒ Quick test failed:", error.message);
    
    if (error.message.includes('No contract found')) {
      console.log("ğŸ’¡ Contract may not be deployed to this network");
      console.log("ğŸ”§ Try running: npm run deploy:sepolia");
    } else {
      console.log("ğŸ’¡ Contract exists but may have ABI mismatch");
      console.log("ğŸ”§ Try recompiling: npm run compile");
    }
    
    process.exit(1);
  }
}

main()
  .then(() => {
    console.log("\nâœ… Quick test passed!");
    process.exit(0);
  })
  .catch((error) => {
    console.error("âŒ Quick test script failed:", error);
    process.exit(1);
  });
